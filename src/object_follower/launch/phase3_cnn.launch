<launch>
  <!-- Phase 3 CNN-Enhanced Object Follower Launch File -->
  
  <!-- Parameters -->
  <param name="use_sim_time" value="false"/>
  
  <!-- CNN Object Detection Node -->
  <node name="cnn_object_detector" pkg="object_follower" type="cnn_object_detector.py" output="screen">
    <param name="detection_mode" value="hybrid"/>        <!-- cnn, color, hybrid -->
    <param name="model_type" value="yolov5n"/>          <!-- yolov5n, mobilenet -->
    <param name="target_class" value="0"/>              <!-- 0=person, see COCO classes -->
    <param name="confidence_threshold" value="0.5"/>    <!-- CNN confidence threshold -->
    <!-- For testing with camera simulator -->
    <remap from="/camera/image_raw" to="/camera/image_raw"/>
  </node>
  
  <!-- Enhanced Motor Controller Node -->
  <node name="enhanced_motor_controller" pkg="object_follower" type="enhanced_motor_controller.py" output="screen">
    <param name="max_speed" value="0.4"/>
    <param name="target_distance" value="1.2"/>  <!-- Slightly farther for person following -->
    <param name="distance_tolerance" value="0.2"/>
    <param name="wheel_distance" value="0.1"/>
    <!-- PID parameters optimized for person following -->
    <param name="kp_lateral" value="1.5"/>
    <param name="ki_lateral" value="0.06"/>
    <param name="kd_lateral" value="0.5"/>
    <param name="kp_distance" value="0.8"/>
    <param name="ki_distance" value="0.03"/>
    <param name="kd_distance" value="0.2"/>
  </node>
  
  <!-- Obstacle Detector Node -->
  <node name="obstacle_detector" pkg="object_follower" type="obstacle_detector.py" output="screen">
    <param name="detection_method" value="edge"/>
    <param name="min_obstacle_area" value="1000"/>
    <param name="safe_distance_pixels" value="120"/>  <!-- More conservative for person following -->
    <remap from="/camera/image_raw" to="/camera/image_raw"/>
  </node>
  
  <!-- Performance Monitor -->
  <node name="performance_monitor" pkg="object_follower" type="performance_monitor.py" output="screen">
    <param name="target_distance" value="1.2"/>
  </node>
  
  <!-- CNN Performance Monitor -->
  <node name="cnn_performance_monitor" pkg="object_follower" type="cnn_performance_monitor.py" output="screen"/>
  
  <!-- Camera Simulator for Testing -->
  <node name="camera_simulator" pkg="object_follower" type="camera_simulator.py" output="screen"/>
  
  <!-- Target Class Selector (for switching between person, objects, etc.) -->
  <!-- Publish to /object_follower/target_class to change target -->
  <!-- 0=person, 1=bicycle, 2=car, etc. (COCO classes) -->
  
</launch>